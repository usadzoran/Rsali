<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Brilex - Gestion des Ventes</title>
<style>
  body { font-family: Arial; background:#f3f3f3; margin:0; padding:0;}
  header { background:#007bff; color:white; padding:10px; text-align:center;}
  nav { display:flex; justify-content:space-around; background:#ddd; }
  nav button { flex:1; padding:10px; border:none; background:#ccc; font-weight:bold;}
  .active { background:#007bff; color:white;}
  section { display:none; padding:15px;}
  .box { background:white; padding:10px; border-radius:8px; margin-bottom:15px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
  input, select { width:95%; padding:7px; margin:5px 0;}
  button { padding:7px 10px; background:#007bff; color:white; border:none; border-radius:5px; margin:5px 0;}
  table { width:100%; border-collapse:collapse; margin-top:10px;}
  th,td { border:1px solid #ccc; padding:6px; text-align:center;}
  #scanner { width:100%; height:200px; border:2px solid #007bff; display:none; margin-top:10px;}
</style>
</head>
<body>

<header><h2>📦 Brilex - Gestion des Ventes</h2></header>
<nav>
  <button class="active" onclick="showSection('produits')">Produits</button>
  <button onclick="showSection('facture')">Facturation</button>
  <button onclick="showSection('analyse')">Analyse</button>
</nav>

<!-- ✅ Section Produits -->
<section id="produits" style="display:block;">
  <div class="box">
    <h3>➕ Ajouter Produit</h3>
    <input id="barcodeInput" placeholder="Code-barres">
    <button onclick="startScanner('barcodeInput')">📷 Scanner</button>
    <input id="productName" placeholder="Nom">
    <input id="productColor" placeholder="Couleur">
    <input id="productPrice" type="number" placeholder="Prix (DA)">
    <button onclick="addProduct()">✅ Enregistrer Produit</button>
  </div>
  <div class="box">
    <h3>📋 Liste Produits</h3>
    <table id="productsTable"><thead><tr><th>Code</th><th>Nom</th><th>Prix</th></tr></thead><tbody></tbody></table>
  </div>
</section>

<!-- ✅ Section Facturation -->
<section id="facture">
  <div class="box">
    <h3>🧾 Créer Facture</h3>
    <input id="clientName" placeholder="Nom Client">
    <input id="clientAddress" placeholder="Adresse Client">
    <input id="scanBarcode" placeholder="Code Produit">
    <button onclick="startScanner('scanBarcode')">📷 Scanner</button>
    <button onclick="addToInvoice()">➕ Ajouter au Panier</button>
    <table id="invoiceTable"><thead><tr><th>Produit</th><th>Prix</th></tr></thead><tbody></tbody></table>
    <h4>Total: <span id="total">0</span> DA</h4>
    <label>Statut Paiement:</label>
    <select id="paymentStatus"><option value="payé">✅ Payé</option><option value="dette">❌ Dette</option></select>
    <button onclick="saveInvoice()">💾 Enregistrer Facture</button>
    <button onclick="printInvoice()">🖨️ Imprimer Facture</button>
  </div>
</section>

<!-- ✅ Section Analyse -->
<section id="analyse">
  <div class="box">
    <h3>📊 Ventes Journalières</h3>
    <table id="salesTable"><thead><tr><th>Date</th><th>Client</th><th>Total</th><th>Statut</th></tr></thead><tbody></tbody></table>
  </div>
</section>

<!-- ✅ Scanner -->
<div id="scanner"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
let products = JSON.parse(localStorage.getItem("products")) || [];
let invoices = JSON.parse(localStorage.getItem("invoices")) || [];
let invoiceItems = [];

// ✅ Navigation
function showSection(id) {
  document.querySelectorAll("section").forEach(s=>s.style.display="none");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById(id).style.display="block";
  event.target.classList.add("active");
  if(id==="produits") renderProducts();
  if(id==="analyse") renderSales();
}

// ✅ Produits
function addProduct(){
  let code=barcodeInput.value.trim(),name=productName.value.trim(),color=productColor.value.trim(),price=parseFloat(productPrice.value);
  if(!code||!name||!price){alert("⚠️ Remplir tous les champs!");return;}
  products.push({code,name,color,price});
  localStorage.setItem("products",JSON.stringify(products));
  renderProducts();alert("✅ Produit ajouté !");
}
function renderProducts(){
  let tb=document.querySelector("#productsTable tbody");tb.innerHTML="";
  products.forEach(p=>tb.innerHTML+=`<tr><td>${p.code}</td><td>${p.name}</td><td>${p.price}</td></tr>`);
}

// ✅ Facturation
function addToInvoice(){
  let code=scanBarcode.value.trim();
  let p=products.find(x=>x.code===code);
  if(!p){alert("❌ Produit introuvable!");return;}
  invoiceItems.push(p);renderInvoice();
}
function renderInvoice(){
  let tb=document.querySelector("#invoiceTable tbody");tb.innerHTML="";let t=0;
  invoiceItems.forEach(p=>{tb.innerHTML+=`<tr><td>${p.name}</td><td>${p.price}</td></tr>`;t+=p.price;});
  total.innerText=t;
}
function saveInvoice(){
  let c=clientName.value.trim(),a=clientAddress.value.trim(),s=paymentStatus.value;
  if(!c||!a||invoiceItems.length===0){alert("⚠️ Remplir infos!");return;}
  invoices.push({client:c,address:a,items:invoiceItems,total:parseFloat(total.innerText),status:s,date:new Date().toLocaleString()});
  localStorage.setItem("invoices",JSON.stringify(invoices));
  invoiceItems=[];renderInvoice();alert("✅ Facture enregistrée !");
}
function renderSales(){
  let tb=document.querySelector("#salesTable tbody");tb.innerHTML="";
  invoices.forEach(f=>tb.innerHTML+=`<tr><td>${f.date}</td><td>${f.client}</td><td>${f.total}</td><td>${f.status}</td></tr>`);
}

// ✅ Impression
function printInvoice(){
  let content = `<h3>Brilex</h3><p>${clientName.value}</p><p>${clientAddress.value}</p><hr>`;
  invoiceItems.forEach(p=>content+=`${p.name} - ${p.price} DA<br>`);
  content+=`<hr>Total: ${total.innerText} DA<br>Statut: ${paymentStatus.value}`;
  let win=window.open();win.document.write(content);win.print();win.close();
}

// ✅ Scanner
function startScanner(inputId){
  scanner.style.display="block";
  Quagga.init({inputStream:{name:"Live",type:"LiveStream",target:scanner,constraints:{facingMode:"environment"}},decoder:{readers:["ean_reader","code_128_reader"]}},err=>{if(err){alert("Erreur Caméra");return;}Quagga.start();});
  Quagga.onDetected(data=>{
    document.getElementById(inputId).value=data.codeResult.code;
    Quagga.stop();scanner.style.display="none";
  });
}
</script>
</body>
</html>
